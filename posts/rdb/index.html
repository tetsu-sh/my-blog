<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="128x128" href="/favicon/favicon-128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32-32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16-16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon-32-32.png"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and Markdown."/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Rdb</title><meta name="next-head-count" content="15"/><script src="https://embed.zenn.studio/js/listen-embed-event.js"></script><link rel="preload" href="/_next/static/css/a22c2f7ee8554c55.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a22c2f7ee8554c55.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cf121497002c184d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cf121497002c184d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-491c01545a840e20.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-455fdf1d9b7b48bd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0f73896300543aa7.js" defer=""></script><script src="/_next/static/chunks/d0447323-452de5d02fa80e1c.js" defer=""></script><script src="/_next/static/chunks/831-17ae48e4ef21c306.js" defer=""></script><script src="/_next/static/chunks/358-bd79b5f955437da8.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-7a79fa351b280d1e.js" defer=""></script><script src="/_next/static/2bess960bV_0rpMQCvK7B/_buildManifest.js" defer=""></script><script src="/_next/static/2bess960bV_0rpMQCvK7B/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><main><div class="flex min-h-screen flex-col"><header><nav class="fixed z-20 w-full bg-gray-700 py-3 text-center font-semibold" aria-label="Header navigation"><span class="test-xs px-2.5 text-neutral-200 hover:text-neutral-500 active:text-gray-600 transition duration-100">home</span><span class="test-xs px-2.5 text-neutral-200 hover:text-neutral-500 active:text-gray-600 transition duration-100">about</span><span class="test-xs px-2.5 text-neutral-200 hover:text-neutral-500 active:text-gray-600 transition duration-100">oisource</span></nav></header><div class="container mx-auto px-5"><article><div></div><div><div class="mt-16"><h1 class="text-5xl md:text-7xl lg:text-3xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Rdb</h1><div class="mb-6 text-lg"><time dateTime="2022-11-20T05:35:07.322Z">November	20, 2022</time></div><div class="max-w-2xl mx-auto"></div></div></div><div class="flex gap-10 znc"><div class="article"><div class="post"><div class="markdown-styles_markdown__h_8de"><h1 id="memo"><a class="header-anchor-link" href="#memo" aria-hidden="true"></a> memo</h1>
<ul>
<li>
<p>json 型は推奨されない</p>
<ul>
<li>web api のレスポンスをそのまま保存するなど json として丸っと扱うケース。あまり update しない</li>
<li>システムが小さい。作成し始めで変更が入る予定がある場合に柔軟性を持たせる</li>
<li>EAV と同じデメリットを持つ.SQL が煩雑になる。INDEX が効かない。</li>
</ul>
</li>
<li>
<p>ジェイウォーク（信号無視）：配列を text 型に突っ込む</p>
</li>
<li>
<p>MySQL では外部キー制約を設定している場合、外部キー制約の子テーブルを更新した際、親テーブルの共有ロックを自動的に取る。MySQL、正規化、外部キー制約注意</p>
</li>
<li>
<p>外部キー(FOREIGN KEY)制約を利用している場合、<br />
子テーブルに追加、更新や削除を行う時は、必ず親テーブルの対象の id に対して排他ロックを行ってから、更新や削除、追加を行う。</p>
</li>
<li>
<p>enum,update_at</p>
</li>
<li>
<p>ビジネスルールをカラム制約にするのはやりすぎなのでは？</p>
</li>
<li>
<p>posgre 遅延制約.commit 時に外部きー制約が評価される。transaction 中は無視</p>
</li>
<li>
<p>postgres は Select でも AccessShareLock をとる</p>
</li>
<li>
<p>ネクストキーロック、ギャップロック mysql</p>
</li>
<li>
<p>join が多段になりパフォーマンスが知恵化した際。安易に非正規化ではなく、マテリアライズどビューを選択肢とする</p>
</li>
<li>
<p>多段マテリアライズドビューはやめましょう</p>
</li>
<li>
<p>クエリの問題を分解する</p>
</li>
<li>
<p>コンフィグ</p>
<ul>
<li>チューニングツールがある</li>
<li></li>
</ul>
</li>
</ul>
<h2 id="sql"><a class="header-anchor-link" href="#sql" aria-hidden="true"></a> SQL</h2>
<ul>
<li>
<p>when は評価が整合したら以降は評価しないので排他的に書く</p>
</li>
<li>
<p>check with when</p>
</li>
</ul>
<div class="code-block-container"><pre class="language-sql"><code class="language-sql"><span class="token keyword">update</span> <span class="token keyword">table</span> <span class="token keyword">set</span> salary <span class="token keyword">case</span>
  <span class="token keyword">when</span> salary<span class="token operator">&gt;</span><span class="token number">300000</span> <span class="token keyword">then</span> salary<span class="token operator">*</span><span class="token number">0.9</span>
  <span class="token keyword">when</span> salary<span class="token operator">&gt;=</span><span class="token number">250000</span> <span class="token operator">and</span> salary<span class="token operator">&lt;</span><span class="token number">280000</span> <span class="token keyword">then</span> salary<span class="token operator">*</span><span class="token number">1.2</span>
<span class="token keyword">else</span> salary
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><div class="code-block-container"><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">case</span> sex <span class="token keyword">when</span> <span class="token number">1</span> <span class="token keyword">then</span> 男 <span class="token keyword">when</span> <span class="token number">2</span> 女 <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span> <span class="token keyword">as</span> 性別 <span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">case</span> <span class="token function">sum</span><span class="token punctuation">(</span>pref_name <span class="token keyword">when</span> <span class="token string">'香川'</span> <span class="token keyword">then</span> populatiom <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> pref_name <span class="token keyword">when</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'香川'</span><span class="token punctuation">,</span><span class="token string">'徳島'</span><span class="token punctuation">,</span><span class="token string">'高知'</span><span class="token punctuation">,</span><span class="token string">'愛媛'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token string">'四国'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> PopTbl2  <span class="token keyword">group</span> <span class="token keyword">by</span> 性別
</code></pre></div><h3 id="window-function"><a class="header-anchor-link" href="#window-function" aria-hidden="true"></a> window function</h3>
<ul>
<li>range row」」」</li>
<li>preceding following</li>
<li>普通の group by 集計と partition by 集計はもちろん結果が違う</li>
<li>組み合わせ表現のための自己結合。非等値結合</li>
<li>過ち排除の自己結合</li>
<li>rank 関数</li>
<li>重複行の削除</li>
<li>not in の中に null があると答えがなくなる。not exist にする</li>
<li>ALL でも null は悪さをする</li>
<li>極地関数の対象が空なら null が帰ってくるので注意。coalesce して回避</li>
<li>null orderby
<ul>
<li>my sql min nulls first/last, is null asc</li>
<li>postgresql max</li>
</ul>
</li>
<li>null str
<ul>
<li>posgre null, concat or coalesce nisuru</li>
<li>mysql null, coalece</li>
</ul>
</li>
<li>non exist 二重否定<br />
all などよりパフォーマンスが良くなるかも</li>
<li>集合的に考えて SQL を組み立てる</li>
<li>having の集合の比較</li>
</ul>
<div class="code-block-container"><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> class <span class="token keyword">from</span> TestResult <span class="token keyword">group</span> <span class="token keyword">by</span> class  <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.75</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> score <span class="token operator">&gt;=</span><span class="token number">80</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> team_id<span class="token punctuation">,</span> member <span class="token keyword">from</span> Teams <span class="token keyword">as</span> <span class="token keyword">TO</span> <span class="token keyword">where</span>  <span class="token operator">not</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> Teams <span class="token keyword">as</span> TI <span class="token keyword">where</span> <span class="token keyword">TO</span><span class="token punctuation">.</span>team_id<span class="token operator">=</span>TI<span class="token punctuation">.</span>team_id <span class="token operator">and</span> TI<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token operator">&lt;&gt;</span><span class="token string">'待機'</span><span class="token punctuation">)</span>

<span class="token keyword">select</span> team_id <span class="token keyword">group</span> <span class="token keyword">by</span> team_id <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token string">'待機'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">=</span>
<span class="token keyword">select</span> team_id<span class="token punctuation">,</span> <span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">status</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'待機'</span> <span class="token operator">and</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">status</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'待機'</span> <span class="token keyword">then</span> <span class="token string">'ok'</span> <span class="token keyword">else</span> <span class="token string">'not stand by'</span> <span class="token keyword">end</span> <span class="token keyword">as</span> <span class="token keyword">status</span> <span class="token keyword">group</span> <span class="token keyword">by</span> team_id<span class="token punctuation">;</span>

バスケット解析
<span class="token keyword">select</span> shop <span class="token keyword">from</span> ShopItem SI <span class="token keyword">join</span> Items I <span class="token keyword">on</span> SI<span class="token punctuation">.</span>item<span class="token operator">=</span>I<span class="token punctuation">.</span>item
<span class="token keyword">group</span> <span class="token keyword">by</span> SI<span class="token punctuation">.</span>shop <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span>SI<span class="token punctuation">.</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token keyword">from</span> items<span class="token punctuation">)</span>


<span class="token keyword">select</span> <span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&lt;&gt;</span><span class="token function">max</span><span class="token punctuation">(</span>seq<span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token string">'hanukeari'</span> <span class="token keyword">else</span> <span class="token string">'hanuke nasi'</span> <span class="token keyword">end</span>

<span class="token keyword">select</span> dpt <span class="token keyword">group</span> <span class="token keyword">by</span> dpt <span class="token keyword">having</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> sbmt<span class="token operator">&lt;</span><span class="token string">'2018-09-30'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token keyword">select</span> shop<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>SI<span class="token punctuation">.</span>item<span class="token punctuation">)</span> <span class="token keyword">as</span> my_item<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">select</span> item <span class="token keyword">from</span> Items<span class="token punctuation">)</span><span class="token operator">-</span>my_item <span class="token keyword">from</span> ShopItems <span class="token keyword">as</span> SI <span class="token keyword">join</span> Items <span class="token keyword">as</span> I <span class="token keyword">on</span> SI<span class="token punctuation">.</span>item<span class="token operator">=</span>I<span class="token punctuation">.</span>item <span class="token keyword">group</span> <span class="token keyword">by</span> shop
</code></pre></div><ul>
<li>前年からの変化を調べる。window function</li>
<li>window function は mysql では 8~</li>
<li>相関サブクエリはウィンドウ関数に書き換えられるとパフォーマンス上がるかも</li>
<li>pagenation もウィンドウ関数で？</li>
</ul>
<p>-　 master を（view で）作って外部結合し、行列</p>
<div class="code-block-container"><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> age_range<span class="token punctuation">,</span>sex<span class="token punctuation">,</span> tblpopchanged<span class="token punctuation">.</span>tohoku<span class="token punctuation">,</span>tblpopchanged<span class="token punctuation">.</span>kanto <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> _ <span class="token keyword">from</span> TblPop <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pref_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'秋田'</span><span class="token punctuation">,</span><span class="token string">'青森'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> population <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tohoku<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pref_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'東京'</span><span class="token punctuation">,</span><span class="token string">'千葉'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> population <span class="token keyword">else</span> <span class="token boolean">null</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> kanto <span class="token punctuation">)</span> <span class="token keyword">as</span> tblpopchanged
<span class="token keyword">outer</span> <span class="token keyword">join</span> <span class="token punctuation">(</span><span class="token keyword">select</span> _ <span class="token keyword">from</span> TblAge <span class="token keyword">cross</span> <span class="token keyword">join</span> TblSex<span class="token punctuation">)</span> <span class="token keyword">as</span> SexAndAge <span class="token keyword">on</span> SexAndAge<span class="token punctuation">.</span>age_class<span class="token operator">=</span>tblpopchanged<span class="token punctuation">.</span>age_class
</code></pre></div></div></div></div></div></article></div></div><style>
        .aside-toc{
          width:300px;
        }
        .article{
          width:(100-aside-toc.width)%
        }
        </style></main></div><footer><div class="p-10 center bg-neutral-800"><div class="flex flex-col items-center gap-4"><div class="flex gap-4"><span class="text-neutral-200 hover:text-neutral-500 active:text-gray-600 transition duration-100" aria-label="Github" href="https://github.com/tetsu-sh"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></span><span class="text-neutral-200 hover:text-neutral-500 active:text-gray-600 transition duration-100" aria-label="Twitter" href="https://twitter.com/tetsu04228"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></div><div class="text-neutral-200 text-sm text-center">© <!-- -->2023<!-- --> Chimu</div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Rdb","date":"2022-11-20T05:35:07.322Z","slug":"rdb","content":"\u003ch1 id=\"memo\"\u003e\u003ca class=\"header-anchor-link\" href=\"#memo\" aria-hidden=\"true\"\u003e\u003c/a\u003e memo\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ejson 型は推奨されない\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eweb api のレスポンスをそのまま保存するなど json として丸っと扱うケース。あまり update しない\u003c/li\u003e\n\u003cli\u003eシステムが小さい。作成し始めで変更が入る予定がある場合に柔軟性を持たせる\u003c/li\u003e\n\u003cli\u003eEAV と同じデメリットを持つ.SQL が煩雑になる。INDEX が効かない。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eジェイウォーク（信号無視）：配列を text 型に突っ込む\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMySQL では外部キー制約を設定している場合、外部キー制約の子テーブルを更新した際、親テーブルの共有ロックを自動的に取る。MySQL、正規化、外部キー制約注意\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e外部キー(FOREIGN KEY)制約を利用している場合、\u003cbr /\u003e\n子テーブルに追加、更新や削除を行う時は、必ず親テーブルの対象の id に対して排他ロックを行ってから、更新や削除、追加を行う。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eenum,update_at\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eビジネスルールをカラム制約にするのはやりすぎなのでは？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eposgre 遅延制約.commit 時に外部きー制約が評価される。transaction 中は無視\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003epostgres は Select でも AccessShareLock をとる\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eネクストキーロック、ギャップロック mysql\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ejoin が多段になりパフォーマンスが知恵化した際。安易に非正規化ではなく、マテリアライズどビューを選択肢とする\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e多段マテリアライズドビューはやめましょう\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eクエリの問題を分解する\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eコンフィグ\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eチューニングツールがある\u003c/li\u003e\n\u003cli\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"sql\"\u003e\u003ca class=\"header-anchor-link\" href=\"#sql\" aria-hidden=\"true\"\u003e\u003c/a\u003e SQL\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ewhen は評価が整合したら以降は評価しないので排他的に書く\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003echeck with when\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token keyword\"\u003eupdate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etable\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e salary \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e salary\u003cspan class=\"token operator\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"token number\"\u003e300000\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e salary\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.9\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e salary\u003cspan class=\"token operator\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"token number\"\u003e250000\u003c/span\u003e \u003cspan class=\"token operator\"\u003eand\u003c/span\u003e salary\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token number\"\u003e280000\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e salary\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token number\"\u003e1.2\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e salary\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e sex \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e 男 \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e 女 \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enull\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e 性別 \u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epopulation\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epref_name \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e \u003cspan class=\"token string\"\u003e'香川'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e populatiom \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e pref_name \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e \u003cspan class=\"token operator\"\u003ein\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'香川'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'徳島'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'高知'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'愛媛'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token string\"\u003e'四国'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e PopTbl2  \u003cspan class=\"token keyword\"\u003egroup\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eby\u003c/span\u003e 性別\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"window-function\"\u003e\u003ca class=\"header-anchor-link\" href=\"#window-function\" aria-hidden=\"true\"\u003e\u003c/a\u003e window function\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003erange row」」」\u003c/li\u003e\n\u003cli\u003epreceding following\u003c/li\u003e\n\u003cli\u003e普通の group by 集計と partition by 集計はもちろん結果が違う\u003c/li\u003e\n\u003cli\u003e組み合わせ表現のための自己結合。非等値結合\u003c/li\u003e\n\u003cli\u003e過ち排除の自己結合\u003c/li\u003e\n\u003cli\u003erank 関数\u003c/li\u003e\n\u003cli\u003e重複行の削除\u003c/li\u003e\n\u003cli\u003enot in の中に null があると答えがなくなる。not exist にする\u003c/li\u003e\n\u003cli\u003eALL でも null は悪さをする\u003c/li\u003e\n\u003cli\u003e極地関数の対象が空なら null が帰ってくるので注意。coalesce して回避\u003c/li\u003e\n\u003cli\u003enull orderby\n\u003cul\u003e\n\u003cli\u003emy sql min nulls first/last, is null asc\u003c/li\u003e\n\u003cli\u003epostgresql max\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003enull str\n\u003cul\u003e\n\u003cli\u003eposgre null, concat or coalesce nisuru\u003c/li\u003e\n\u003cli\u003emysql null, coalece\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003enon exist 二重否定\u003cbr /\u003e\nall などよりパフォーマンスが良くなるかも\u003c/li\u003e\n\u003cli\u003e集合的に考えて SQL を組み立てる\u003c/li\u003e\n\u003cli\u003ehaving の集合の比較\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e class \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e TestResult \u003cspan class=\"token keyword\"\u003egroup\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eby\u003c/span\u003e class  \u003cspan class=\"token keyword\"\u003ehaving\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.75\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e score \u003cspan class=\"token operator\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"token number\"\u003e80\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e team_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e member \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e Teams \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eTO\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhere\u003c/span\u003e  \u003cspan class=\"token operator\"\u003enot\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eexists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e Teams \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e TI \u003cspan class=\"token keyword\"\u003ewhere\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eTO\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eteam_id\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eteam_id \u003cspan class=\"token operator\"\u003eand\u003c/span\u003e TI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estatus\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"token string\"\u003e'待機'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e team_id \u003cspan class=\"token keyword\"\u003egroup\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eby\u003c/span\u003e team_id \u003cspan class=\"token keyword\"\u003ehaving\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatus\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'待機'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e team_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e \u003cspan class=\"token function\"\u003emax\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'待機'\u003c/span\u003e \u003cspan class=\"token operator\"\u003eand\u003c/span\u003e \u003cspan class=\"token function\"\u003emin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'待機'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token string\"\u003e'ok'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token string\"\u003e'not stand by'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatus\u003c/span\u003e \u003cspan class=\"token keyword\"\u003egroup\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eby\u003c/span\u003e team_id\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nバスケット解析\n\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e shop \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e ShopItem SI \u003cspan class=\"token keyword\"\u003ejoin\u003c/span\u003e Items I \u003cspan class=\"token keyword\"\u003eon\u003c/span\u003e SI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eitem\n\u003cspan class=\"token keyword\"\u003egroup\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eby\u003c/span\u003e SI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshop \u003cspan class=\"token keyword\"\u003ehaving\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eSI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e items\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"token function\"\u003emax\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eseq\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token string\"\u003e'hanukeari'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token string\"\u003e'hanuke nasi'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e dpt \u003cspan class=\"token keyword\"\u003egroup\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eby\u003c/span\u003e dpt \u003cspan class=\"token keyword\"\u003ehaving\u003c/span\u003e \u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e sbmt\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token string\"\u003e'2018-09-30'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e shop\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eSI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e my_item\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e item \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e Items\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003emy_item \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e ShopItems \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e SI \u003cspan class=\"token keyword\"\u003ejoin\u003c/span\u003e Items \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e I \u003cspan class=\"token keyword\"\u003eon\u003c/span\u003e SI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eI\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eitem \u003cspan class=\"token keyword\"\u003egroup\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eby\u003c/span\u003e shop\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e前年からの変化を調べる。window function\u003c/li\u003e\n\u003cli\u003ewindow function は mysql では 8~\u003c/li\u003e\n\u003cli\u003e相関サブクエリはウィンドウ関数に書き換えられるとパフォーマンス上がるかも\u003c/li\u003e\n\u003cli\u003epagenation もウィンドウ関数で？\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e-　 master を（view で）作って外部結合し、行列\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e age_range\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003esex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tblpopchanged\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etohoku\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003etblpopchanged\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekanto \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e _ \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e TblPop \u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e pref_name \u003cspan class=\"token operator\"\u003ein\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'秋田'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'青森'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e population \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enull\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tohoku\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token function\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewhen\u003c/span\u003e pref_name \u003cspan class=\"token operator\"\u003ein\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'東京'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'千葉'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e population \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enull\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e kanto \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tblpopchanged\n\u003cspan class=\"token keyword\"\u003eouter\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ejoin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e _ \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e TblAge \u003cspan class=\"token keyword\"\u003ecross\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ejoin\u003c/span\u003e TblSex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e SexAndAge \u003cspan class=\"token keyword\"\u003eon\u003c/span\u003e SexAndAge\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eage_class\u003cspan class=\"token operator\"\u003e=\u003c/span\u003etblpopchanged\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eage_class\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"rdb"},"buildId":"2bess960bV_0rpMQCvK7B","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>